{% extends "browse/base/property_table.html" %}

{% load i18n %}
{% load tz %}
{% load filters %}

{% block dataset_type %}
    {% trans "Bus location data" %}
{% endblock %}

{% block owner_search_link %}
    {% url 'avl-search' host host.name %}?organisation={{ property.organisation.id }}
{% endblock %}

{% block datatype_content %}
    <tr class="govuk-table__row">
        <th scope="row" class="govuk-table__header">
            {% filter force_escape %}{% trans 'BODS Compliant data' %}{% endfilter %}
            {% include 'browse/snippets/help_modals/AVL_bods_compliance.html' %}
        </th>
        {% if show_url %}
            <td class="govuk-table__cell dont-break-out" colspan="2">
                <div class="stacked">
                    <span>
                        <i class="fas fa-exclamation-circle fa"></i>
                        {{ property.avl_compliance_status_cached }}
                    </span>
                    <a class="govuk-link"
                        href="{% url "avl:validation-report-download" pk1=property.organisation_id pk=property.id host hosts.publish %}">
                        {% trans "Download validation report" %}
                    </a>
                </div>
            </td>
        {% else %}
            <td class="govuk-table__cell dont-break-out govuk-!-padding-top-0 govuk-!-padding-bottom-5" colspan="2">
                {{ property.avl_compliance_status_cached }}
            </td>
        {% endif %}
    </tr>
    <tr class="govuk-table__row">
        <th scope="row" class="govuk-table__header">{% trans 'SIRI-VM version' %}</th>
        <td class="govuk-table__cell" colspan="2">{{property.live_revision.metadata.schema_version}}</td>
    </tr>
    <tr class="govuk-table__row">
        <th scope="row" class="govuk-table__header">{% trans 'Feed details last updated' %}</th>
        <td class="govuk-table__cell dont-break-out">
            {{ property.published_at|localtime|date:"j M Y H:i" }} {% trans 'by ' %}
            {% if property.live_revision.published_by %}
                {{ property.live_revision.published_by.username }}
            {% else %}
                {% trans 'System' %}
            {% endif %}
        </td>
        <td class="govuk-table__cell">
            <a class="govuk-link"
                href="{% url 'avl-feed-changelog' pk=property.id host host.name %}"
            >
                {% trans 'View change log' %}
            </a>
        </td>
    </tr>
    <tr class="govuk-table__row">
        <th scope="row" class="govuk-table__header">{% trans 'Last automated update' %}</th>
        <td class="govuk-table__cell" colspan="2">
            {{ property.avl_feed_last_checked|date:"j M Y H:i" }}
        </td>
    </tr>
{% endblock %}
